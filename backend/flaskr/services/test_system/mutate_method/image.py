import re
import base64
from io import BytesIO
from PIL import Image


# Convert Base64 String to PIL.Image
def from_base64(base64_str, image_path=None):
    base64_data = re.sub('^data:image/.+;base64,', '', base64_str)
    byte_data = base64.b64decode(base64_data)
    image_data = BytesIO(byte_data)
    img = Image.open(image_data)
    if image_path:
        img.save(image_path)
    return img


# Convert PIL.Image to Base64 String
def to_base64(img):
    output_buffer = BytesIO()
    img.save(output_buffer, format='JPEG')
    byte_data = output_buffer.getvalue()
    base64_str = base64.b64encode(byte_data)
    return "data:image/jpeg;base64," + str(base64_str, 'utf-8')
